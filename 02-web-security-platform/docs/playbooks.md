# 作业剧本与操作指引（Playbooks）

将“如何做”沉淀为可复用操作剧本，覆盖任务编排、扫描策略、误报处理、协作与通知等场景，确保在不同团队/周期下可复制、可审计。

## 1. 任务编排 Playbook
- 定时基线：每日被动/轻量主动扫描；每周全量扫描；重大版本前加密集扫描
- 增量策略：对变更资产（新增 URL/参数/组件）仅做增量扫描
- 执行窗口：业务低峰时段；对内外网分别设定扫描窗口和并发上限
- 白黑名单：
  - 白名单：授权资产域、路径、IP 段
  - 黑名单：生产关键交易链路、缓存清理接口等敏感端点（需审批后开启）

## 2. 扫描策略 Playbook
- Web（ZAP）：
  - 发现阶段：爬取深度、用户上下文、认证会话、排除规则
  - 攻击阶段：被动优先，主动扫描对核心系统采用限速和范围控制
- 网络（OpenVAS）：
  - 使用“Full and fast”模板起步，根据网络分段定制端口/协议
  - 对生产/核心网络启用更严格的速率与时间窗口
- 依赖（Dependency-Check）：
  - CI 阶段执行，按项目类型（Java/Node/Python）选择最佳实践
  - 设定质量门禁（临时阻断阈值 + 豁免清单）
- 基线（Lynis）：
  - 关注 SSH、内核参数、审计策略等关键项；将“建议”映射为整改任务
- 泄露（Gitleaks）：
  - 对主干与发布分支常态化执行；配置排除目录与假阳性规则

## 3. 误报处理 Playbook
- 人工校验：结合 Burp Suite 重放与验证
- 误报规则：来源（扫描器/规则/URL/参数）、证据模式、过期时间
- 自动抑制：导出误报规则库，扫描前加载，减少重复噪音
- 审计闭环：每月回顾命中率与规则有效性，清理陈旧规则

## 4. 协作与通知 Playbook
- 分派：DefectDojo 基于产品/组件自动派发负责人
- 阈值与升级：
  - 高危实时：企业微信直达负责人与安全群
  - 中危日报：邮件与 DefectDojo 仪表盘
  - 逾期升级：创建/升级 Jira 工单并通知团队负责人
- 报告：面向管理层的月报（趋势图、Top 漏洞、修复率）与专项报告

## 5. 合规与审计 Playbook
- 合规映射：将漏洞项与 PCI/GDPR/等保控制项映射，输出整改状态
- 留痕：记录扫描计划、豁免与审批、修复验证证据，满足审计要求

## 6. 安全控制与资源配额
- 并发与限速：为每类扫描器配置最大并发、连接/请求速率
- 配额：按业务/部门分配扫描配额与配额告警
- 弹性策略：高峰暂停/降级为被动扫描；夜间/周末做重扫描

## 7. 常见问题与故障排查（摘要）
- 扫描器连接失败：检查容器网络、代理、DNS；查看健康检查端点
- 认证失效：更新 Token 与登录脚本；验证上下文与会话保持
- 导入失败：检查结果格式与版本，确认 DefectDojo 导入器适配
- 指标不一致：核对归一化逻辑与时间窗口，校验仪表盘数据源